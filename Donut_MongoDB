{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "195e4ea0",
   "metadata": {},
   "outputs": [],
   "source": [
    "from bs4 import BeautifulSoup\n",
    "import requests\n",
    "import time\n",
    "import os\n",
    "from pprint import pprint\n",
    "import re\n",
    "import codecs\n",
    "from pymongo import MongoClient"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "309f15d5",
   "metadata": {},
   "source": [
    "## Question 1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "9c26b0d7",
   "metadata": {},
   "outputs": [],
   "source": [
    "headers = {\n",
    "        \"user-agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36\" ,\n",
    "        \"authority\": \"www.tagesschau.de\",\n",
    "        \"method\": \"GET\",\n",
    "        \"path\":\"/\",\n",
    "        \"scheme\":\"https\",\n",
    "        \"accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\",\n",
    "        \"accept-encoding\": \"gzip, deflate, br\",\n",
    "        \"accept-language\": \"en-US,en;q=0.9,de;q=0.8\",\n",
    "        \"cache-control\": \"max-age=0\",\n",
    "        \"cookie\": \"atuserid=%7B%22name%22%3A%22atuserid%22%2C%22val%22%3A%2257ea5dd6-4c35-4982-942f-8a7f8b8c3a4b%22%2C%22options%22%3A%7B%22end%22%3A%222023-02-17T05%3A02%3A59.936Z%22%2C%22path%22%3A%22%2F%22%7D%7D; atidvisitor=%7B%22name%22%3A%22atidvisitor%22%2C%22val%22%3A%7B%22vrn%22%3A%22-595936-%22%7D%2C%22options%22%3A%7B%22path%22%3A%22%2F%22%2C%22session%22%3A15724800%2C%22end%22%3A15724800%7D%7D\",\n",
    "        \"sec-ch-ua-mobile\": \"?0\",\n",
    "        \"sec-ch-ua-platform\": \"Windows\",\n",
    "        \"sec-fetch-dest\": \"document\",\n",
    "        \"sec-fetch-mode\": \"navigate\",\n",
    "        \"sec-fetch-site\": \"none\",\n",
    "        \"sec-fetch-user\": \"?1\",\n",
    "        \"upgrade-insecure-requests\": \"1\"\n",
    "    }"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "551f7e9a",
   "metadata": {},
   "outputs": [],
   "source": [
    "def saveString(html, filename=\"test.html\"):\n",
    "    try:\n",
    "        file = open(filename,\"w\")\n",
    "        file.write(str(html))\n",
    "        file.close()\n",
    "    except Exception as ex:\n",
    "        print('Error: ' + str(ex))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "f754db9e",
   "metadata": {},
   "outputs": [],
   "source": [
    "base_url = \"https://www.yelp.com/search?find_desc=Donut+Shop&find_loc=San+Francisco%2C+CA&ns=1\"\n",
    "\n",
    "for page_num, donut_num in enumerate(range(0, 40, 10), start=1):\n",
    "    url = base_url + \"&start=\" + str(donut_num)\n",
    "    page = requests.get(url ,headers=headers)\n",
    "    book_productpage = BeautifulSoup(page.text, 'lxml')\n",
    "    name = \"sf_donut_shop_search_page_\" + str(page_num) + \".html\"\n",
    "    saveString(book_productpage,filename=name)\n",
    "    \n",
    "    time.sleep(10)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "38730eb3",
   "metadata": {},
   "source": [
    "## Question 2"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "78270347",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[{'Link': 'https://www.yelp.com/biz/bobs-donuts-and-pastry-shop-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Bob’s Donuts & Pastry Shop',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '1',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '3328',\n",
      "  'Service Tags': [],\n",
      "  'Store Tags': ['Bakeries', 'Donuts']},\n",
      " {'Link': 'https://www.yelp.com/biz/uncle-bennys-donut-and-bagel-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Uncle Benny’s Donut and Bagel',\n",
      "  'Order Button': True,\n",
      "  'Price Range': '$$',\n",
      "  'Rank': '2',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '389',\n",
      "  'Service Tags': ['Outdoor dining', 'Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Donuts', 'Bagels', 'Coffee & Tea']},\n",
      " {'Link': 'https://www.yelp.com/biz/twisted-donuts-and-coffee-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Twisted Donuts and Coffee',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '3',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '508',\n",
      "  'Service Tags': ['Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Donuts', 'Bakeries']},\n",
      " {'Link': 'https://www.yelp.com/biz/bobs-donuts-san-francisco-2?osq=Donut+Shop',\n",
      "  'Name': 'Bob’s Donuts',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '4',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '117',\n",
      "  'Service Tags': ['Takeout'],\n",
      "  'Store Tags': ['Donuts', 'Bakeries']},\n",
      " {'Link': 'https://www.yelp.com/biz/all-star-donuts-san-francisco-3?osq=Donut+Shop',\n",
      "  'Name': 'All Star Donuts',\n",
      "  'Order Button': True,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '5',\n",
      "  'Rating': '4 star rating',\n",
      "  'Rating Count': '280',\n",
      "  'Service Tags': ['Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Donuts', 'Sandwiches', 'Coffee & Tea']},\n",
      " {'Link': 'https://www.yelp.com/biz/dynamo-donut-and-coffee-san-francisco-4?osq=Donut+Shop',\n",
      "  'Name': 'Dynamo Donut & Coffee',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '6',\n",
      "  'Rating': '4 star rating',\n",
      "  'Rating Count': '1945',\n",
      "  'Service Tags': ['Delivery', 'Takeout', 'Curbside Pickup'],\n",
      "  'Store Tags': ['Coffee & Tea', 'Donuts', 'Patisserie/Cake Shop']},\n",
      " {'Link': 'https://www.yelp.com/biz/donut-world-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Donut World',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '7',\n",
      "  'Rating': '4 star rating',\n",
      "  'Rating Count': '275',\n",
      "  'Service Tags': ['Takeout'],\n",
      "  'Store Tags': ['Coffee & Tea', 'Donuts']},\n",
      " {'Link': 'https://www.yelp.com/biz/golden-donuts-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Golden Donuts',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '8',\n",
      "  'Rating': '4 star rating',\n",
      "  'Rating Count': '124',\n",
      "  'Service Tags': ['Outdoor dining'],\n",
      "  'Store Tags': ['Donuts', 'Coffee & Tea', 'Sandwiches']},\n",
      " {'Link': 'https://www.yelp.com/biz/the-jelly-donut-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'The Jelly Donut',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '9',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '272',\n",
      "  'Service Tags': [],\n",
      "  'Store Tags': ['Donuts', 'Coffee & Tea']},\n",
      " {'Link': 'https://www.yelp.com/biz/happy-donuts-san-francisco-18?osq=Donut+Shop',\n",
      "  'Name': 'Happy Donuts',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '10',\n",
      "  'Rating': '4 star rating',\n",
      "  'Rating Count': '269',\n",
      "  'Service Tags': [],\n",
      "  'Store Tags': ['Donuts', 'Coffee & Tea']},\n",
      " {'Link': 'https://www.yelp.com/biz/glaze-donuts-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Glaze Donuts',\n",
      "  'Order Button': True,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '11',\n",
      "  'Rating': '4 star rating',\n",
      "  'Rating Count': '89',\n",
      "  'Service Tags': ['Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Donuts', 'Breakfast & Brunch', 'Bagels']},\n",
      " {'Link': 'https://www.yelp.com/biz/mochill-mochi-donut-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Mochill Mochi Donut',\n",
      "  'Order Button': True,\n",
      "  'Price Range': None,\n",
      "  'Rank': '12',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '819',\n",
      "  'Service Tags': ['Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Donuts']},\n",
      " {'Link': 'https://www.yelp.com/biz/dynamo-donut-and-coffee-san-francisco-3?osq=Donut+Shop',\n",
      "  'Name': 'Dynamo Donut & Coffee',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '13',\n",
      "  'Rating': '4 star rating',\n",
      "  'Rating Count': '140',\n",
      "  'Service Tags': ['Delivery', 'Curbside Pickup'],\n",
      "  'Store Tags': ['Coffee & Tea', 'Donuts']},\n",
      " {'Link': 'https://www.yelp.com/biz/rolling-pin-donuts-san-bruno?osq=Donut+Shop',\n",
      "  'Name': 'Rolling Pin Donuts',\n",
      "  'Order Button': True,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '14',\n",
      "  'Rating': '4 star rating',\n",
      "  'Rating Count': '783',\n",
      "  'Service Tags': ['Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Bakeries', 'Donuts']},\n",
      " {'Link': 'https://www.yelp.com/biz/hahdough-san-francisco-5?osq=Donut+Shop',\n",
      "  'Name': 'Hahdough',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$$',\n",
      "  'Rank': '15',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '72',\n",
      "  'Service Tags': ['Delivery'],\n",
      "  'Store Tags': ['Donuts', 'Patisserie/Cake Shop', 'Pretzels']},\n",
      " {'Link': 'https://www.yelp.com/biz/grand-mission-donuts-and-bakery-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Grand Mission Donuts & Bakery',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '16',\n",
      "  'Rating': '4 star rating',\n",
      "  'Rating Count': '104',\n",
      "  'Service Tags': [],\n",
      "  'Store Tags': ['Donuts', 'Bakeries']},\n",
      " {'Link': 'https://www.yelp.com/biz/johnny-doughnuts-san-francisco-4?osq=Donut+Shop',\n",
      "  'Name': 'Johnny Doughnuts',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$$',\n",
      "  'Rank': '17',\n",
      "  'Rating': '3.5 star rating',\n",
      "  'Rating Count': '220',\n",
      "  'Service Tags': ['Outdoor dining', 'Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Donuts', 'Coffee & Tea', 'Food Trucks']},\n",
      " {'Link': 'https://www.yelp.com/biz/donuts-and-things-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Donuts & Things',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '18',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '119',\n",
      "  'Service Tags': ['Outdoor dining', 'Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Donuts', 'Coffee & Tea']},\n",
      " {'Link': 'https://www.yelp.com/biz/devils-teeth-baking-company-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Devil’s Teeth Baking Company',\n",
      "  'Order Button': True,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '19',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '1845',\n",
      "  'Service Tags': ['Outdoor dining', 'Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Bakeries', 'Breakfast & Brunch', 'Sandwiches']},\n",
      " {'Link': 'https://www.yelp.com/biz/happy-donuts-san-francisco-15?osq=Donut+Shop',\n",
      "  'Name': 'Happy Donuts',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '20',\n",
      "  'Rating': '3 star rating',\n",
      "  'Rating Count': '50',\n",
      "  'Service Tags': ['Takeout'],\n",
      "  'Store Tags': ['Donuts']},\n",
      " {'Link': 'https://www.yelp.com/biz/dough-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Dough',\n",
      "  'Order Button': True,\n",
      "  'Price Range': None,\n",
      "  'Rank': '21',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '73',\n",
      "  'Service Tags': ['Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Donuts', 'Pizza']},\n",
      " {'Link': 'https://www.yelp.com/biz/jim-georgies-donuts-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Jim Georgie’s Donuts',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '22',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '172',\n",
      "  'Service Tags': ['Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Donuts', 'American (Traditional)']},\n",
      " {'Link': 'https://www.yelp.com/biz/california-bakery-san-francisco-3?osq=Donut+Shop',\n",
      "  'Name': 'California Bakery',\n",
      "  'Order Button': False,\n",
      "  'Price Range': None,\n",
      "  'Rank': '23',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '46',\n",
      "  'Service Tags': ['Takeout', 'Curbside Pickup'],\n",
      "  'Store Tags': ['Bakeries']},\n",
      " {'Link': 'https://www.yelp.com/biz/donut-farm-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Donut Farm',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '24',\n",
      "  'Rating': '4 star rating',\n",
      "  'Rating Count': '319',\n",
      "  'Service Tags': ['Takeout'],\n",
      "  'Store Tags': ['Donuts', 'Vegan']},\n",
      " {'Link': 'https://www.yelp.com/biz/hookt-doughnuts-san-francisco-3?osq=Donut+Shop',\n",
      "  'Name': 'Hookt Doughnuts',\n",
      "  'Order Button': True,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '25',\n",
      "  'Rating': '4 star rating',\n",
      "  'Rating Count': '154',\n",
      "  'Service Tags': ['Outdoor dining', 'Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Donuts', 'Desserts', 'Sandwiches']},\n",
      " {'Link': 'https://www.yelp.com/biz/choux-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Choux',\n",
      "  'Order Button': True,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '26',\n",
      "  'Rating': '4 star rating',\n",
      "  'Rating Count': '302',\n",
      "  'Service Tags': ['Outdoor dining', 'Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Bakeries', 'Desserts', 'French']},\n",
      " {'Link': 'https://www.yelp.com/biz/royal-donut-daly-city?osq=Donut+Shop',\n",
      "  'Name': 'Royal Donut',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '27',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '146',\n",
      "  'Service Tags': [],\n",
      "  'Store Tags': ['Donuts', 'Coffee & Tea']},\n",
      " {'Link': 'https://www.yelp.com/biz/donut-king-south-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Donut King',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '28',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '22',\n",
      "  'Service Tags': [],\n",
      "  'Store Tags': ['Donuts', 'Coffee & Tea', 'Breakfast & Brunch']},\n",
      " {'Link': 'https://www.yelp.com/biz/all-star-cafe-san-francisco-3?osq=Donut+Shop',\n",
      "  'Name': 'All Star Cafe',\n",
      "  'Order Button': True,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '29',\n",
      "  'Rating': '4 star rating',\n",
      "  'Rating Count': '208',\n",
      "  'Service Tags': ['Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Donuts', 'Coffee & Tea', 'Breakfast & Brunch']},\n",
      " {'Link': 'https://www.yelp.com/biz/happy-donuts-san-francisco-4?osq=Donut+Shop',\n",
      "  'Name': 'Happy Donuts',\n",
      "  'Order Button': True,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '30',\n",
      "  'Rating': '3.5 star rating',\n",
      "  'Rating Count': '73',\n",
      "  'Service Tags': ['Delivery'],\n",
      "  'Store Tags': ['Donuts', 'Bagels', 'Breakfast & Brunch']},\n",
      " {'Link': 'https://www.yelp.com/biz/king-pin-donuts-berkeley?osq=Donut+Shop',\n",
      "  'Name': 'King Pin Donuts',\n",
      "  'Order Button': True,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '31',\n",
      "  'Rating': '4 star rating',\n",
      "  'Rating Count': '666',\n",
      "  'Service Tags': ['Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Donuts', 'Desserts']},\n",
      " {'Link': 'https://www.yelp.com/biz/third-culture-bakery-berkeley?osq=Donut+Shop',\n",
      "  'Name': 'Third Culture Bakery',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$$',\n",
      "  'Rank': '32',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '889',\n",
      "  'Service Tags': ['Delivery', 'Takeout', 'Curbside Pickup'],\n",
      "  'Store Tags': ['Bakeries', 'Coffee & Tea', 'Desserts']},\n",
      " {'Link': 'https://www.yelp.com/biz/trishs-mini-donuts-san-francisco-3?osq=Donut+Shop',\n",
      "  'Name': 'Trish’s Mini Donuts',\n",
      "  'Order Button': True,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '33',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '961',\n",
      "  'Service Tags': ['Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Donuts']},\n",
      " {'Link': 'https://www.yelp.com/biz/butter-love-bakeshop-san-francisco-2?osq=Donut+Shop',\n",
      "  'Name': 'Butter Love Bakeshop',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$$',\n",
      "  'Rank': '34',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '183',\n",
      "  'Service Tags': ['Takeout'],\n",
      "  'Store Tags': ['Desserts', 'Bakeries']},\n",
      " {'Link': 'https://www.yelp.com/biz/top-of-the-hill-cafe-daly-city?osq=Donut+Shop',\n",
      "  'Name': 'Top of the Hill Cafe',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '35',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '104',\n",
      "  'Service Tags': [],\n",
      "  'Store Tags': ['Donuts']},\n",
      " {'Link': 'https://www.yelp.com/biz/happy-donut-san-francisco-8?osq=Donut+Shop',\n",
      "  'Name': 'Happy Donut',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '36',\n",
      "  'Rating': '4 star rating',\n",
      "  'Rating Count': '42',\n",
      "  'Service Tags': [],\n",
      "  'Store Tags': ['Donuts']},\n",
      " {'Link': 'https://www.yelp.com/biz/happy-donuts-san-francisco-19?osq=Donut+Shop',\n",
      "  'Name': 'Happy Donuts',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '37',\n",
      "  'Rating': '3.5 star rating',\n",
      "  'Rating Count': '218',\n",
      "  'Service Tags': [],\n",
      "  'Store Tags': ['Donuts', 'Vietnamese', 'Thai']},\n",
      " {'Link': 'https://www.yelp.com/biz/donut-petit-alameda-5?osq=Donut+Shop',\n",
      "  'Name': 'Donut Petit',\n",
      "  'Order Button': True,\n",
      "  'Price Range': '$$',\n",
      "  'Rank': '38',\n",
      "  'Rating': '4.5 star rating',\n",
      "  'Rating Count': '163',\n",
      "  'Service Tags': ['Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Donuts']},\n",
      " {'Link': 'https://www.yelp.com/biz/dunkin-south-san-francisco-2?osq=Donut+Shop',\n",
      "  'Name': 'Dunkin’',\n",
      "  'Order Button': True,\n",
      "  'Price Range': '$',\n",
      "  'Rank': '39',\n",
      "  'Rating': '2.5 star rating',\n",
      "  'Rating Count': '307',\n",
      "  'Service Tags': ['Delivery', 'Takeout'],\n",
      "  'Store Tags': ['Coffee & Tea', 'Donuts']},\n",
      " {'Link': 'https://www.yelp.com/biz/donut-times-san-francisco?osq=Donut+Shop',\n",
      "  'Name': 'Donut Times',\n",
      "  'Order Button': False,\n",
      "  'Price Range': '$$',\n",
      "  'Rank': '40',\n",
      "  'Rating': '3.5 star rating',\n",
      "  'Rating Count': '56',\n",
      "  'Service Tags': ['Delivery'],\n",
      "  'Store Tags': ['Donuts', 'Bakeries', 'Coffee & Tea']}]\n"
     ]
    }
   ],
   "source": [
    "shops = []\n",
    "for page_num in range(1, 5):\n",
    "    name = \"sf_donut_shop_search_page_\" + str(page_num) + \".html\"\n",
    "    f =codecs.open(name, 'r', 'utf-8')\n",
    "    soup = BeautifulSoup(f.read(), 'lxml')\n",
    "    \n",
    "    name_tags = soup.find_all('div', attrs={'class': re.compile('^businessName.*')})\n",
    "    list_items = [i.find_parent('li') for i in name_tags if re.match(r\"^[0-9]+\\.\\s\", i.text)]\n",
    "\n",
    "    for item in list_items:\n",
    "        shop_info = {}\n",
    "        shop_info[\"Rank\"] = item.select('h3')[0].find(text=True)\n",
    "        shop_info[\"Name\"] = item.select('h3 > span > a')[0].find(text=True)\n",
    "        shop_info[\"Link\"] = f\"https://www.yelp.com{item.select('h3 > span > a')[0].get('href')}\"\n",
    "        shop_info[\"Rating\"] = item.find_all('div', attrs={'class': re.compile('^i-stars.*')})[0].get('aria-label')\n",
    "        shop_info[\"Rating Count\"] = item.find_all('span', attrs={'class': re.compile('^reviewCount.*')})[0].text\n",
    "        shop_info[\"Store Tags\"] = [tag.text for tag in item.select('a > button > p')]\n",
    "        \n",
    "        price_element = item.find_all('span', attrs={'class': re.compile('^priceRange.*')})\n",
    "        if len(price_element) > 0:\n",
    "            shop_info[\"Price Range\"] = price_element[0].text\n",
    "        else:\n",
    "            shop_info[\"Price Range\"] = None\n",
    "            \n",
    "        order_element = item.find_all('span', text=re.compile(\"Start Order\"))\n",
    "        if len(order_element) > 0:\n",
    "            shop_info[\"Order Button\"] = True\n",
    "        else:\n",
    "            shop_info[\"Order Button\"] = False\n",
    "            \n",
    "        service_tags = item.find_all('div', attrs={'class': re.compile('^border-color.*'), 'data-testid': re.compile('TRUSTED_PROPERTY')})\n",
    "        if len(service_tags) > 0:\n",
    "            shop_info[\"Service Tags\"] = [tag.text for tag in service_tags[0].find_all('div') if tag.text != \"\"]\n",
    "        else:\n",
    "            shop_info[\"Service Tags\"] = []\n",
    "\n",
    "        shops.append(shop_info)\n",
    "pprint(shops)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a9578971",
   "metadata": {},
   "source": [
    "## Question 3"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "60673993",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<pymongo.results.InsertManyResult at 0x7feff27c35c0>"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "client = MongoClient(port=27017)\n",
    "db = client[\"ddr\"]\n",
    "col = db[\"donut_shops\"]\n",
    "col.insert_many(shops)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cba14233",
   "metadata": {},
   "source": [
    "## Question 4"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "id": "2a5219fd",
   "metadata": {},
   "outputs": [],
   "source": [
    "for shop in shops:\n",
    "    url = shop['Link']\n",
    "    page = requests.get(url ,headers=headers)\n",
    "    donut_productpage = BeautifulSoup(page.text, 'lxml')\n",
    "    name = \"sf_donut_shop_\" + str(shop['Rank']) + \".html\"\n",
    "    saveString(donut_productpage,filename=name)\n",
    "    \n",
    "    time.sleep(10)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "06c90364",
   "metadata": {},
   "source": [
    "## Question 5 & Question 6"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "id": "0c689b47",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[{'Address': '1621 Polk St San Francisco, CA 94109',\n",
      "  'Name': 'Bob’s Donuts & Pastry Shop',\n",
      "  'Phone Number': '(415) 776-3141',\n",
      "  'Website': 'http://www.bobsdonutssf.com',\n",
      "  'geolocation': (37.791852, -122.421276)},\n",
      " {'Address': '2049 Irving St San Francisco, CA 94122',\n",
      "  'Name': 'Uncle Benny’s Donut and Bagel',\n",
      "  'Phone Number': '(628) 219-0956',\n",
      "  'geolocation': (37.763299, -122.480192)},\n",
      " {'Address': '1243 Noriega St San Francisco, CA 94122',\n",
      "  'Name': 'Twisted Donuts and Coffee',\n",
      "  'Phone Number': '(415) 463-5437',\n",
      "  'Website': 'http://twisteddonutsf.com',\n",
      "  'geolocation': (37.754095, -122.477233)},\n",
      " {'Address': '601 Baker St San Francisco, CA 94117',\n",
      "  'Name': 'Bob’s Donuts',\n",
      "  'Phone Number': '(415) 776-3141',\n",
      "  'Website': 'https://www.bobsdonutssf.com',\n",
      "  'geolocation': (37.776539, -122.441854)},\n",
      " {'Address': '901 Clement St San Francisco, CA 94118',\n",
      "  'Name': 'All Star Donuts',\n",
      "  'Phone Number': '(415) 221-9838',\n",
      "  'geolocation': (37.782559, -122.468983)},\n",
      " {'Address': '1399 9th Ave San Francisco, CA 94122',\n",
      "  'Name': 'Donut World',\n",
      "  'Phone Number': '(415) 665-4240',\n",
      "  'geolocation': (37.762306, -122.466344)},\n",
      " {'Address': '2760 24th St San Francisco, CA 94110',\n",
      "  'Name': 'Dynamo Donut & Coffee',\n",
      "  'Phone Number': '(415) 920-1978',\n",
      "  'Website': 'http://www.dynamodonut.com',\n",
      "  'geolocation': (37.753022, -122.407644)},\n",
      " {'Address': '5401 Geary Blvd San Francisco, CA 94121',\n",
      "  'Name': 'Golden Donuts',\n",
      "  'Phone Number': '(415) 422-0623',\n",
      "  'geolocation': (37.780247, -122.477407)},\n",
      " {'Address': '3198 24th St San Francisco, CA 94110',\n",
      "  'Name': 'The Jelly Donut',\n",
      "  'Phone Number': '(415) 648-1419',\n",
      "  'Website': 'http://the-jelly-donut-san-fra…',\n",
      "  'geolocation': (37.752483, -122.416148)},\n",
      " {'Address': '3801 24th St San Francisco, CA 94114',\n",
      "  'Name': 'Happy Donuts',\n",
      "  'Phone Number': '(415) 285-5890',\n",
      "  'geolocation': (37.751594, -122.427598)},\n",
      " {'Address': '4499 Mission St San Francisco, CA 94112',\n",
      "  'Name': 'Glaze Donuts',\n",
      "  'Phone Number': '(415) 334-1144',\n",
      "  'geolocation': (37.726248, -122.43328)},\n",
      " {'Address': '1737 Post St Ste 395 San Francisco, CA 94115',\n",
      "  'Name': 'Mochill Mochi Donut',\n",
      "  'Phone Number': '(650) 619-2462',\n",
      "  'Website': 'https://www.mochillsf.com',\n",
      "  'geolocation': (37.778008, -122.431272)},\n",
      " {'Address': '429 San Bruno Ave W San Bruno, CA 94066',\n",
      "  'Name': 'Rolling Pin Donuts',\n",
      "  'Phone Number': '(650) 589-9687',\n",
      "  'Website': 'http://www.rollingpindonut.com',\n",
      "  'geolocation': (37.62934, -122.414512)},\n",
      " {'Address': '392 Fulton St San Francisco, CA 94102',\n",
      "  'Name': 'Johnny Doughnuts',\n",
      "  'Phone Number': '(415) 400-5078',\n",
      "  'Website': 'http://johnnydoughnuts.com',\n",
      "  'geolocation': (37.77889, -122.423215)},\n",
      " {'Address': '1549 Polk St San Francisco, CA 94109',\n",
      "  'Name': 'Donuts & Things',\n",
      "  'Phone Number': '(415) 885-1942',\n",
      "  'geolocation': (37.791235, -122.421144)},\n",
      " {'Address': '3876 Noriega St San Francisco, CA 94122',\n",
      "  'Name': 'Devil’s Teeth Baking Company',\n",
      "  'Phone Number': '(415) 683-5533',\n",
      "  'Website': 'http://devilsteethbakingcompan…',\n",
      "  'geolocation': (37.753119, -122.505033)},\n",
      " {'Address': '1794 Haight St San Francisco, CA 94117',\n",
      "  'Name': 'Happy Donuts',\n",
      "  'Phone Number': '(415) 386-1650',\n",
      "  'geolocation': (37.769631, -122.45173)},\n",
      " {'Address': '2462 San Bruno Ave San Francisco, CA 94134',\n",
      "  'Name': 'Jim Georgie’s Donuts',\n",
      "  'Phone Number': '(415) 468-3413',\n",
      "  'geolocation': (37.730834, -122.405088)},\n",
      " {'Address': '110 Yacht Rd San Francisco, CA 94123',\n",
      "  'Name': 'Dynamo Donut & Coffee',\n",
      "  'Phone Number': '(415) 920-1978',\n",
      "  'Website': 'http://www.dynamodonut.com',\n",
      "  'geolocation': (37.806542, -122.447255)},\n",
      " {'Address': '509 Laguna St San Francisco, CA 94102',\n",
      "  'Name': 'Hahdough',\n",
      "  'Phone Number': '(415) 676-0576',\n",
      "  'Website': 'http://hahdough.com',\n",
      "  'geolocation': (37.77586, -122.426313)},\n",
      " {'Address': '1379 4th St San Francisco, CA 94158',\n",
      "  'Name': 'Hookt Doughnuts',\n",
      "  'Phone Number': '(415) 890-6577',\n",
      "  'Website': 'http://www.hooktdoughnuts.com',\n",
      "  'geolocation': (37.778008, -122.431272)},\n",
      " {'Address': '504 Grand Ave South San Francisco, CA 94080',\n",
      "  'Name': 'Donut King',\n",
      "  'Phone Number': '(650) 742-6736',\n",
      "  'geolocation': (37.653515, -122.344612)},\n",
      " {'Address': '2195 Mission St San Francisco, CA 94110',\n",
      "  'Name': 'Grand Mission Donuts & Bakery',\n",
      "  'Phone Number': None,\n",
      "  'geolocation': (37.762004, -122.419065)},\n",
      " {'Address': '98 9th St San Francisco, CA 94103',\n",
      "  'Name': 'All Star Cafe',\n",
      "  'Phone Number': '(415) 863-4949',\n",
      "  'Website': 'http://allstarcafe.top-cafes.c…',\n",
      "  'geolocation': (37.776285, -122.415086)},\n",
      " {'Address': '2521 Durant Ave Ste A Berkeley, CA 94704',\n",
      "  'Name': 'King Pin Donuts',\n",
      "  'Phone Number': '(510) 843-6688',\n",
      "  'Website': 'http://www.kingpindonuts.com',\n",
      "  'geolocation': (37.868213, -122.258032)},\n",
      " {'Address': 'Pier 39 Concourse San Francisco, CA 94133',\n",
      "  'Name': 'Trish’s Mini Donuts',\n",
      "  'Phone Number': '(415) 981-4318',\n",
      "  'Website': 'https://www.trishcaters.com',\n",
      "  'geolocation': (37.778008, -122.431272)},\n",
      " {'Address': '100 Bush St San Francisco, CA 94111',\n",
      "  'Name': 'Happy Donuts',\n",
      "  'Phone Number': '(415) 398-6769',\n",
      "  'geolocation': (37.791569, -122.399964)},\n",
      " {'Address': '6300 Mission St Daly City, CA 94014',\n",
      "  'Name': 'Top of the Hill Cafe',\n",
      "  'Phone Number': '(650) 731-8999',\n",
      "  'geolocation': (37.676219, -122.481757)},\n",
      " {'Address': '299 Ellis St San Francisco, CA 94102',\n",
      "  'Name': 'Happy Donut',\n",
      "  'Phone Number': '(415) 440-1010',\n",
      "  'geolocation': (37.784894, -122.410896)},\n",
      " {'Address': '719 Taraval St San Francisco, CA 94116',\n",
      "  'Name': 'California Bakery',\n",
      "  'Phone Number': '(415) 864-1385',\n",
      "  'geolocation': (37.743007, -122.47392)},\n",
      " {'Address': '1 Ferry Bldg Ste 14 San Francisco, CA 94111',\n",
      "  'Name': 'Donut Farm',\n",
      "  'Phone Number': None,\n",
      "  'Website': 'https://www.vegandonut.farm',\n",
      "  'geolocation': (37.796258, -122.393871)},\n",
      " {'Address': '180 S Airport Blvd South San Francisco, CA 94080',\n",
      "  'Name': 'Dunkin’',\n",
      "  'Phone Number': '(650) 742-9101',\n",
      "  'Website': 'http://www.dunkindonuts.com',\n",
      "  'geolocation': (37.649398, -122.405989)},\n",
      " {'Address': '2401 Noriega St San Francisco, CA 94122',\n",
      "  'Name': 'Donut Times',\n",
      "  'Phone Number': '(415) 753-8997',\n",
      "  'geolocation': (37.753509, -122.489483)},\n",
      " {'Address': '2025 San Pablo Ave Berkeley, CA 94702',\n",
      "  'Name': 'Rainbow Donuts',\n",
      "  'Phone Number': '(510) 644-2029',\n",
      "  'geolocation': (37.868707, -122.291562)},\n",
      " {'Address': '3251 20th Ave Level 1 San Francisco, CA 94132',\n",
      "  'Name': 'Mochill Mochi Donut',\n",
      "  'Phone Number': None,\n",
      "  'Website': 'http://www.mochillsf.com',\n",
      "  'geolocation': (37.727735, -122.476655)},\n",
      " {'Address': '1455 Market St San Francisco, CA 94103',\n",
      "  'Name': 'Dough',\n",
      "  'Phone Number': '(415) 864-0888',\n",
      "  'Website': 'https://www.sfdough.com',\n",
      "  'geolocation': (37.775238, -122.417523)},\n",
      " {'Address': '615 Linden Ave South San Francisco, CA 94080',\n",
      "  'Name': 'Las Hijas Del Gallo Bakery',\n",
      "  'Phone Number': '(650) 446-3223',\n",
      "  'Website': 'https://www.southsanfranciscoc…',\n",
      "  'geolocation': (37.658691, -122.409228)},\n",
      " {'Address': '236 Skyline Plz Daly City, CA 94015',\n",
      "  'Name': 'Royal Donut',\n",
      "  'Phone Number': '(650) 997-3758',\n",
      "  'geolocation': (37.676219, -122.481757)},\n",
      " {'Address': '1575 Sullivan Ave Daly City, CA 94015',\n",
      "  'Name': 'Krispy Kreme',\n",
      "  'Phone Number': '(650) 985-5612',\n",
      "  'Website': 'http://www.krispykreme.com',\n",
      "  'geolocation': (37.676219, -122.481757)},\n",
      " {'Address': '2101 Van Ness Ave San Francisco, CA 94109',\n",
      "  'Name': 'Happy Donuts',\n",
      "  'Phone Number': '(415) 800-7399',\n",
      "  'Website': 'http://happydonutssanfrancisco…',\n",
      "  'geolocation': (37.795039, -122.423627)}]\n"
     ]
    }
   ],
   "source": [
    "donut_detail = []\n",
    "\n",
    "base_url = \"http://api.positionstack.com/v1/\"\n",
    "API_KEY = \"52fb6e9394e0eadb757e3ef26bb46ab9\"\n",
    "\n",
    "for page_num in range(1, 41):\n",
    "    name = \"sf_donut_shop_\" + str(page_num) + \".html\"\n",
    "    f =codecs.open(name, 'r', 'utf-8')\n",
    "    soup = BeautifulSoup(f.read(), 'lxml')\n",
    "\n",
    "    shop_info = {}\n",
    "\n",
    "    shop_info[\"Name\"] = soup.select('h1')[0].text.replace(\"'\", \"’\")\n",
    "    \n",
    "    phone_element = soup.find_all('p', text=re.compile(\"Phone number\"))\n",
    "    if len(phone_element) > 0:\n",
    "        shop_info[\"Phone Number\"] = phone_element[0].find_parent('div').find_all('p')[1].text\n",
    "    else:\n",
    "        shop_info[\"Phone Number\"] = None\n",
    "        \n",
    "    shop_info[\"Address\"] = soup.find_all('address')[0].get_text(separator=' ')\n",
    "    \n",
    "    website_element = soup.find_all('p', text=re.compile(\"Business website\"))\n",
    "    if len(website_element) > 0:\n",
    "        shop_info[\"Website\"] = website_element[0].find_parent('div').find_all('p')[1].text\n",
    "    \n",
    "    # Get Geolocation\n",
    "    url = base_url + \"forward?access_key=\" + API_KEY + \"&query=\" + str(shop_info['Address'])\n",
    "    r = requests.get(url ,headers=headers)\n",
    "    r = r.json()[\"data\"][0]\n",
    "    shop_info[\"geolocation\"] = (r[\"latitude\"], r[\"longitude\"])\n",
    "    \n",
    "    # Update database\n",
    "    db.sf_donut_shops.find_one_and_update({'Name': shop_info['Name']}, {'$set': shop_info})\n",
    "\n",
    "    donut_detail.append(shop_info)\n",
    "\n",
    "pprint(donut_detail)\n",
    "\n",
    "# Reset Index\n",
    "db.sf_donut_shops.create_index(\"Rank\")"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
